# Prime_Finder 设计项目

## 第一部分：项目简介

### 任务目标
设计一个名为 **"Prime_Finder"** 的系统，用于判断一个4位二进制数是否为质数。

### 项目背景
质数具有有趣且实用的特性。例如，质数是现代加密技术的核心，用于信息加密以实现网络安全传输。具体来说，公钥加密和RSA算法都依赖于质数的使用。（相关内容将在四年级课程 EBU7140 安全与认证 中详细学习）

### 分数分配
- **总分**：12分（占模块总成绩的12%）
- **阶段1（必做）**：0-4分
- **阶段2（选做）**：最高额外8分

---

## 第二部分：阶段1详细规格

### 阶段1任务
按照实验指南开发一个基本系统，用于检测一个4位二进制数是否为质数。需要：
1. 准备可工作的代码
2. 将代码下载到 DE10-Lite 开发板
3. 演示系统正常运行

### 系统结构

系统必须包含以下6个模块（子系统），不得添加额外模块：

| 编号 | 模块名称 | 描述 | 层级关系 |
|------|----------|------|----------|
| 1 | **And_2bit** | 将两个单比特进行AND运算，产生单比特输出。必须使用AND逻辑门构建。 | 子模块 |
| 2 | **Full_adder** | 全加器：将两个单比特数和一个进位输入相加，输出单比特结果和进位输出。必须使用AND、OR、XOR逻辑门构建（参考讲座"EBU6335-24_08-Adders"）。 | 子模块 |
| 3 | **Multiplier_4bit** | 4位乘法器：将两个4位二进制数相乘，产生8位二进制输出。必须使用全加器和AND门构建（参考讲座"EBU6335-24_20-Arithmetic" 第24页）。必须采用模块化方法（参考讲座"EBU6335-24_04-VHDL_CircuitModel"）。 | 模块1和2的父级 |
| 4 | **RipSub_4bit** | 4位纹波减法器：配置为从一个4位二进制数中减去另一个。产生4位二进制输出和进位输出。必须使用AND、OR、XOR、NOT逻辑门构建。 | 独立模块 |
| 5 | **LongDivision_4bit** | 4位长除法器：将一个4位二进制数除以另一个，生成4位商和4位余数。应实现长除法原理，主要代码由包含多个if语句的process语句组成。 | 模块3和4的父级 |
| 6 | **Prime_Finder** | 质数查找器：检查"LongDivision_4bit"生成的商和余数，判断被除数是否为质数。 | 模块5的父级（顶层） |

### 库使用限制

| 模块 | 允许的库 |
|------|----------|
| 模块1-4 | 仅限 `IEEE.std_logic_1164.all` |
| 模块5-6 | 可使用 `IEEE.std_logic_unsigned.all`和`std_logic_unsigned`（仅用于计数器的增减操作） |

**注意**：模块5和6必须使用时钟（CLK）和加载（Load）信号。

### 顶层输入输出

根据框图（Fig. 1），Prime_Finder 顶层设计实体的接口如下：

```
输入信号：
├── Dividend  [3:0]  -- 4位被除数
├── Divisor   [3:0]  -- 4位除数
├── Load             -- 加载信号
└── CLK              -- 时钟信号

输出信号：
├── Q_out     [3:0]  -- 4位商
├── R_out     [3:0]  -- 4位余数
└── Is_Prime         -- 质数标志（1=是质数）
```

### DE10-Lite 开发板引脚分配

| 信号名称 | 开发板资源 |
|----------|------------|
| Dividend | SW4 到 SW7 |
| Divisor | SW0 到 SW3 |
| Load | SW9 |
| Q_out | HEX0 和 HEX1（十进制显示） |
| R_out | HEX4 和 HEX5（十进制显示） |
| Is_Prime | LED9 |

**重要**：七段显示器必须以**十进制**（非十六进制）显示数值。

### 文件命名规范

- **顶层文件**：`Prime_Finder_GroupX`（X为组号，如Group10）
- **子文件**：所有子文件名必须包含 `_GroupX` 后缀

### 设计限制

1. **硬件实现原则**：每个功能必须反映实际硬件实现方式
   - 加法必须使用全加器
   - 乘法和除法必须使用手工算法实现

2. **库限制**：
   - 模块1-4：仅使用 `IEEE.std_logic_1164.all`
   - 模块5-6：可使用 `std_logic_arith` 和 `std_logic_unsigned`（仅用于计数器）

3. **允许使用**：
   - 任意中间信号、逻辑运算符、关系运算符
   - 信号赋值语句、条件信号赋值语句（when-else, with-select）
   - VHDL process 语句

### 测试要求

1. **单独测试**：每个模块必须单独测试并提供证据
2. **仿真测试**：使用 ModelSim 软件的 testbench 文件验证代码
3. **板级测试**：在 DE10-Lite 开发板上演示系统运行
4. **证据形式**：短视频，清晰展示代码和 ModelSim 波形

### 调试建议

在测试阶段，建议为各模块添加额外输出（如 `Dividend_out`、`Divider_out`）以检查中间结果。**提交最终代码前必须移除这些调试输出。**

---

## 层级结构图

```
Prime_Finder (顶层)
└── LongDivision_4bit
    ├── Multiplier_4bit
    │   ├── And_2bit
    │   └── Full_adder
    └── RipSub_4bit
```

---

## 质数判断逻辑提示

4位二进制数范围：0-15

该范围内的质数：**2, 3, 5, 7, 11, 13**

判断质数的方法：
- 检查该数是否只能被1和自身整除
- 使用除法器检查从2到sqrt(n)的所有可能除数
- 如果任何除法的余数为0（且商不为1），则不是质数

---

## 团队分工建议

大多数小组有4-6人，建议分工：
- **模块1（And_2bit）**：较简单，负责人可同时开发另一模块
- **模块2（Full_adder）**：较简单
- **模块3（Multiplier_4bit）**：复杂度中等
- **模块4（RipSub_4bit）**：复杂度中等
- **模块5（LongDivision_4bit）**：复杂，建议专人负责
- **模块6（Prime_Finder）**：复杂，建议专人负责

团队需协作确保各模块兼容并能正确协同工作。

---

## 第三部分：阶段2详细规格

### 阶段2任务

阶段2需要做一些**创新且独特**的工作来改进基本设计。有多种选择，但工作必须专注于**提升系统检测质数的能力或性能**。

### 可尝试的改进方向

- **扩展位数**：将系统扩展到4位以上，以便测试更大的数
- **提高速度**：增加系统检测质数的速度
- **减少资源**：减少设计使用的硬件资源

### 性能对比要求

如果选择改进设计（如提高计算速度），改进的效果只能通过**与原设计对比**来体现。因此必须：

1. 将阶段1设计的性能与阶段2设计的性能进行对比
2. 清楚解释并提供证据证明所声称的性能提升
3. 评审员没有时间自行寻找证据，**提供证据是你的责任**

---

## 第四部分：提交要求

每组只需提交**一个视频**和**一个项目文件夹**。视频应包含所有组员。只需一人提交（建议组长提交）。

### 提交1：演示视频

准备一个演示视频，证明设计正常工作。要求：

- **总时长**：最多13分钟
- **语言**：全程使用英语
- **表达**：用自己的理解和语言表达（保留进行现场答辩的权利）
- **重要**：每位组员都需要自我介绍并说明自己的贡献，如果只有一人代表全组介绍将扣分

#### 视频内容结构

| 部分 | 内容 | 时长建议 |
|------|------|----------|
| 1 | **自我介绍**：姓名和QMUL学号，需露脸 | ~30秒/人 |
| 2 | **阶段1仿真验证**：在ModelSim中分别验证4个主模块（模块3-6），需生成相应testbench文件，解释testbench和仿真结果 | ~2分钟 |
| 3 | **阶段1板级验证**：将代码下载到DE10-Lite开发板，验证整体系统运行正确，解释测试用例和结果 | ~1分30秒 |
| 4 | **知识展示**：在第2、3部分讨论中展示对电路设计、VHDL建模和软件工具使用的理解 | ~4分钟 |
| 5 | **阶段2展示**：展示阶段2所做工作的证据 | ~5分钟 |

### 提交2：VHDL代码压缩包

一个zip文件夹，包含6个模块的VHDL代码、项目文件和testbench文件。

#### 文件夹结构要求

```
提交的zip文件夹/
├── READ ME.txt          -- 必须包含！
├── Phase1项目文件夹/    -- 阶段1的完整Quartus Prime项目
└── Phase2项目文件夹/    -- 阶段2的完整Quartus Prime项目（如有）
```

#### READ ME文件内容

在顶层zip文件夹中必须添加名为 "READ ME" 的文本文件，内容格式如下：

```
"文件夹名称1" = Phase 1
"文件夹名称2" = Phase 2
```

如果只完成了阶段1，可以省略第二个项目文件夹。

#### 重要提醒

- 必须提交**完整的Quartus Prime项目文件夹**
- 文件夹必须完整，能够直接在Quartus Prime中打开和运行
- **提交前请检查**：确保项目可以正常打开和运行
- 如果无法打开和运行你的文件，将无法进行评审，**这是你的责任**

---

## 第五部分：重要说明与澄清

### 关于Dividend和Divisor输入

你可能会疑惑为什么需要同时输入 `Dividend`（被除数）和 `Divisor`（除数）。原因是：

> "Prime_Finder"有多个子模块，你需要思考**执行哪些测试**来检查"Dividend"是否为质数，以及如何在指定的结构内实现。你需要同时使用"Dividend"和"Divisor"来完成这个任务。

**换句话说**：用户需要手动设置不同的除数来测试被除数是否为质数，观察每次除法的商和余数结果。

### 关于乘法器8位输出与除法器4位输出

题目提到"Multiplier_4bit"输入两个4位数，产生8位输出；而"LongDivision_4bit"生成4位商和4位余数。这是正确的设计——根据乘法结果和商/余数的使用方式，这样设计可以正常工作。

### 调试输出建议

在测试阶段，建议为不同模块添加额外输出（如 `Dividend_out`、`Divider_out`）以检查中间结果。

**⚠️ 提交最终代码前必须移除这些调试输出！**

---

## 附录：4位数范围内的质数

| 十进制 | 二进制 | 是否质数 |
|--------|--------|----------|
| 0 | 0000 | ❌ |
| 1 | 0001 | ❌ |
| 2 | 0010 | ✅ |
| 3 | 0011 | ✅ |
| 4 | 0100 | ❌ |
| 5 | 0101 | ✅ |
| 6 | 0110 | ❌ |
| 7 | 0111 | ✅ |
| 8 | 1000 | ❌ |
| 9 | 1001 | ❌ |
| 10 | 1010 | ❌ |
| 11 | 1011 | ✅ |
| 12 | 1100 | ❌ |
| 13 | 1101 | ✅ |
| 14 | 1110 | ❌ |
| 15 | 1111 | ❌ |

**质数列表**：2, 3, 5, 7, 11, 13（共6个）
